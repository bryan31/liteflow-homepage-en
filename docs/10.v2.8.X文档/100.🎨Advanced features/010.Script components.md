---
title: üçãScript component
date: 2022-07-02 17:48:18
permalink: /pages/40b16f/
---

LiteFlow supports scripting nodes. Support hot refresh script, you can choose to write two kinds of scripts: QLExpress and Groovy.

You may be familiar with the syntax of these two scripting languages in advance. Here are two tutorials:

[Groovy Grammar Tutorial](https://www.w3cschool.cn/groovy/)

[QLExpress Grammar tutorial](https://github.com/alibaba/QLExpress)


## How to define

The script node definition is in the rule file, you need to do the following definition (here takes the xml file format as an example):

```xml
<?xml version="1.0" encoding="UTF-8"?>
<flow>
    <nodes>
        <node id="s1" name="Common Script" type="script">
            <![CDATA[
                a=3;
                b=2;
                defaultContext.setData("s1",a*b);
            ]]>
        </node>

        <node id="s2" name="Switch Script" type="switch_script">
            <![CDATA[
                count = defaultContext.getData("count");
                if(count > 100){
                    return "a";
                }else{
                    return "b";
                }
            ]]>
        </node>

        <node id="s3" name="If Script" type="if_script">
            <![CDATA[
                return false;
            ]]>
        </node>
    </nodes>

    <chain name="chain1">
        THEN(a, b, c, s1)
    </chain>

    <chain name="chain2">
        THEN(d, SWITCH(s2).to(a, b)
    </chain>

    <chain name="chain3">
        THEN(d, IF(s3, b, c));
    </chain>
</flow>
```

It should be noted that there are three types of `type`:

`script`: normal script node, no need to return in the script

`switch_script`: Select the script node, the selected node ID needs to be returned in the script

`if_script`: Conditional script node, the script needs to return true/false

You can write dynamic scripts to handle business logic in the place of the example.

:::tip tip

The example here is that the incoming context bean is the default `DefaultContext`. If it is your custom context bean, please call the corresponding method to set and get data.

:::



## Definition of file scripts

LiteFlow supports script files since 2.6.4. In addition to writing the script content in the configuration file, you can also write it in a file. If the script is large, it is recommended to write it in a file. The IDE is also relatively friendly to the syntax highlighting and code hinting of files. Writing scripts would be more convenient.

It should be noted that currently LiteFlow only supports script files in the classpath, and absolute paths cannot be defined here. May be supported in the future.

You can define it like this (example in xml file format):

```xml
<?xml version="1.0" encoding="UTF-8"?>
<flow>
    <nodes>
        <node id="s1" name="Common Script" type="script" file="xml-script-file/s1.groovy"/>
        <node id="s2" name="Switch Script" type="switch_script" file="xml-script-file/s2.groovy"/>
    </nodes>

    <chain name="chain1">
        THEN(a, b, c, s1)
    </chain>

    <chain name="chain2">
        THEN(d, SWITCH(s2).to(a, b))
    </chain>
</flow>
```


## How to interact with java variables

Because LiteFlow component data is in the context, in a scripting language you can get the data by the camelCase of the className where you define the data context.

For example, your context class is called `OrderContext`, then the keyword `orderContext` is used in the script to obtain data or call methods.

If you have multiple contexts, you can also use multiple contexts in your script to get data or call logic methods inside the context.

If you want to get the initial parameters of the chain, the script presets the `requestData` keyword.

If your script is in an implicit process and you want to get the input parameters of the current implicit chain, you should use the `subRequestData` keyword.

**Common script components do not need a return value. Just set the result to `context` (this is the same as a common component in java).** 

**For the switch script node, you need to return the node ID to which the component is routed in the script, and return the String type (this is also same as a switch component in java).** 



## How to choose a scripting framework

LiteFlow uses the SPI mechanism to select the scripting framework to compile your scripts.

QLExpress script, you need additional dependencies:

```xml
<dependency>
    <groupId>com.yomahub</groupId>
    <artifactId>liteflow-script-qlexpress</artifactId>
    <version>2.8.5</version>
</dependency>
```

Groovy script, you need additional dependencies:

```xml
<dependency>
    <groupId>com.yomahub</groupId>
    <artifactId>liteflow-script-groovy</artifactId>
    <version>2.8.5</version>
</dependency>
```

You only need to depend on the corresponding script framework, SPI will dynamically select the script framework.



## How the script runs

LiteFlow precompiles all scripts at startup, so there is no need to compile each time they are executed, and the running performance is not much different from java.



## How to dynamically refresh scripts

Liteflow provides refresh in coded form:

```java
ScriptExecutorFactory.loadInstance().getScriptExecutor().load(nodeId, script);
```
